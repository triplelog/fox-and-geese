<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div id="container">
		<div>
			<img id="bg" src="bg.svg" />
			<svg id="fg" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="1250" height="1250" version="1.1" viewBox="0 75 1250 1250">
				<style>
					#circles {
						pointer-events: none;
					}
					circle {
						fill: white;
						stroke: black;
						stroke-width: 2;
						cursor: pointer;
						pointer-events: all;
					}
					circle.current {
						stroke-width: 3;
						stroke: red;
					}
					text {
						--tsc: black;
					}
					circle.current + text {
						--tsc: red;
					}
					tspan {
						display: none;
					}
					tspan {
						text-shadow: 1px 1px 1px var(--tsc), -1px -1px 1px var(--tsc), -1px 1px 1px var(--tsc), 1px -1px 1px var(--tsc), 2px 2px 2px var(--tsc), -2px -2px 2px var(--tsc), -2px 2px 2px var(--tsc), 2px -2px 2px var(--tsc);
					}
					circle.goose {
						fill: #88F;
						opacity: 0;
					}
					circle.goose + text tspan:nth-child(1) {
						display: block;
					}
					circle.fox {
						fill: #F88;
						opacity: 0;
					}
					circle.fox + text tspan:nth-child(2) {
						display: block;
					}
					
				</style>
				
				<g id="circles" transform="scale(2.083333333)">

					<circle cx="531" cy="570" r="10" id="node-0"></circle><text x="520" y="576" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="495" cy="449" r="10" id="node-1"></circle><text x="484" y="455" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="470" cy="403" r="10" id="node-2"></circle><text x="459" y="409" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="475" cy="372" r="10" id="node-3"></circle><text x="464" y="378" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="493" cy="341" r="10" id="node-4"></circle><text x="482" y="347" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="432" cy="364" r="10" id="node-5"></circle><text x="421" y="370" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="434" cy="330" r="10" id="node-6"></circle><text x="423" y="336" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="552" cy="201" r="10" id="node-7"></circle><text x="541" y="207" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="503" cy="171" r="10" id="node-8"></circle><text x="492" y="177" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="411" cy="165" r="10" id="node-9"></circle><text x="400" y="171" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="431" cy="199" r="10" id="node-10"></circle><text x="420" y="205" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="322" cy="156" r="10" id="node-11"></circle><text x="311" y="162" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="499" cy="222" r="10" id="node-12"></circle><text x="488" y="228" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="585" cy="268" r="10" id="node-13"></circle><text x="574" y="274" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="249" cy="137" r="10" id="node-14"></circle><text x="238" y="143" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="219" cy="158" r="10" id="node-15"></circle><text x="208" y="164" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="287" cy="222" r="10" id="node-16"></circle><text x="276" y="228" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="345" cy="297" r="10" id="node-17"></circle><text x="334" y="303" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="240" cy="266" r="10" id="node-18"></circle><text x="229" y="272" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="196" cy="322" r="10" id="node-19"></circle><text x="185" y="328" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="240" cy="380" r="10" id="node-20"></circle><text x="229" y="386" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="279" cy="399" r="10" id="node-21"></circle><text x="268" y="405" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="340" cy="403" r="10" id="node-22"></circle><text x="329" y="409" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="249" cy="200" r="10" id="node-23"></circle><text x="238" y="206" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="328" cy="205" r="10" id="node-24"></circle><text x="317" y="211" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="23" cy="559" r="10" id="node-25"></circle><text x="12" y="565" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="95" cy="560" r="10" id="node-26"></circle><text x="84" y="566" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="73" cy="527" r="10" id="node-27"></circle><text x="62" y="533" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="109" cy="476" r="10" id="node-28"></circle><text x="98" y="482" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="112" cy="406" r="10" id="node-29"></circle><text x="101" y="412" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="180" cy="432" r="10" id="node-30"></circle><text x="169" y="438" font-size="20"><tspan>矽</tspan><tspan></tspan></text><circle cx="253" cy="448" r="10" id="node-31"></circle><text x="242" y="454" font-size="20"><tspan>矽</tspan><tspan></tspan></text>
				</g>
				
			</svg>
		</div>
		  
		
		
	</div>
	<script src="foxai.js">

	</script>
	<script>
		let lines = [[26,27,28,29,19,18,16,11,9,8,7],[19,15,14,11,24,17,22,21,20,19],[25,0,1,22,31,25],[1,2,3,4,13,7],[13,12,10,24,16,23,15],[29,30,31,21,17,6,4,12,8],[3,5,6,10,9],[25,27,28,30,19],[0,1,2,5,17,16]];
		let moves = [];
		let jumps = [];
		let movesT = [];
		for (var i=0;i<32;i++){
			moves.push(new Set());
			jumps.push(new Set());
			movesT.push(new Set());
		}
		for (var i=0;i<lines.length;i++){
			for (var j=1;j<lines[i].length;j++){
				let a = lines[i][j-1];
				let b = lines[i][j];
				moves[a].add(b);
				moves[b].add(a);
				movesT[a].add(b);
				movesT[b].add(a);
			}
		}
		for (var i=0;i<lines.length;i++){
			for (var j=1;j<lines[i].length;j++){
				let a = lines[i][j-1];
				let b = lines[i][j];
				
				if (j<lines[i].length-1){
					let c = lines[i][j+1];
					jumps[a].add([b,c]);
					jumps[c].add([b,a]);
					movesT[a].delete(b);
					movesT[c].delete(b);
				}
				else if (lines[i][j] == lines[i][0]){
					let c = lines[i][1];
					jumps[a].add([b,c]);
					jumps[c].add([b,a]);
					movesT[a].delete(b);
					movesT[c].delete(b);
				}
			}
		}
		let scores = {0:{d:0,m:moves[0].size}};
		for (var i=1;i<100;i++){
			for (var j=0;j<32;j++){
				let mv = Infinity;
				if (scores[j]){mv = scores[j].d-1;}
				for (var k in scores){
					if (moves[j].has(parseInt(k))){
						if (scores[k].d<mv){
							mv = scores[k].d;
						}
					}
				}
				if (mv < Infinity){
					scores[j]={d:mv+1,m:moves[j].size}
				}
				
			}
		}
		let scoresF = [17,7,8,20,19,19,9,5,9,20,22,14,6,8,9,13,6,13,3,6,7,11,7,9,19,8,20,11,17,13,9,13];
		let scoresFT = [[10,8,7,8],[11,13,9,17]];
		function move(occupied,start,end){
			return occupied + end - start;
		}
		function jump(occupied,start,middle,end){
			return occupied + end - start - middle;
		}
		let occupied = 0;
		let currentGoose = -1;
		for (var i=0;i<32;i++){
			if (i < 16){
				occupied += 1 << i;
				if (i != 14){
					document.getElementById('node-'+i).classList.add('goose');
				}
			}
			document.getElementById('node-'+i).addEventListener('click',clickCity);
		}
		let fox = 14;
		document.getElementById('node-'+fox).classList.add('fox');


		function clickCity(evt){
			let id = parseInt(evt.currentTarget.id.substring(5));
			if (currentGoose == id || fox == id){
				if (currentGoose > -1){
					document.getElementById('node-'+currentGoose).classList.remove('current');
				}
				currentGoose = -1;
				return;
			}
			else if (currentGoose > -1 && moves[currentGoose].has(id) && (~occupied & (1 <<id))){
				occupied = move(occupied,1<<currentGoose,1<<id);
				document.getElementById('node-'+id).classList.add('goose');
				document.getElementById('node-'+currentGoose).classList.remove('goose');
				document.getElementById('node-'+currentGoose).classList.remove('current');
				currentGoose = -1;
				let minEval = foxTurn(occupied,fox,2);
				if (!minEval){return;}
				if (minEval.type == 0){
					occupied = move(occupied,1<<fox, 1<<minEval.k);
					document.getElementById('node-'+minEval.k).classList.add('fox');
					document.getElementById('node-'+fox).classList.remove('fox');
					fox = minEval.k;
				}
				else if (minEval.type == 1){
					occupied = jump(occupied,1<<fox, 1<<minEval.k[0],1<<minEval.k[1]);
					document.getElementById('node-'+minEval.k[1]).classList.add('fox');
					document.getElementById('node-'+fox).classList.remove('fox');
					document.getElementById('node-'+minEval.k[0]).classList.remove('goose');
					fox = minEval.k[1];
				}
				return;
			}
			else {
				document.getElementById('node-'+id).classList.add('current');
				if (currentGoose > -1){
					document.getElementById('node-'+currentGoose).classList.remove('current');
				}
				currentGoose = id;
			}
		}
	</script>
</body>
</html>